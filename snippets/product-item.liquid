{%- assign color_label_list = 'general.label.color' | t | replace: ', ', ',' | downcase | split: ',' -%}
{%- assign color_white_label = 'general.label.white' | t | downcase -%}
{%- assign quick_buy_icon_name = 'quick-buy-' | append: settings.cart_icon | replace: '_', '-' -%}
{% comment %}{% assign current_product = product.handle %}{% endcomment %}

{%- if product.url contains '?' -%}
  {%- assign product_url_contains_query = true -%}
{%- else -%}
  {%- assign product_url_contains_query = false -%}
{%- endif -%}
<product-item class="product-item {% unless product.available %}product-item--sold-out{% endunless %}" {% if reveal %}reveal{% endif %}>
  {%- capture product_labels -%}
    {%- for tag in product.tags -%}
      {%- if tag contains '__label' -%}
        <span class="label label--custom{% if tag contains '__label2' %}2{% endif %}">{{ tag | split: ':' | last }}</span>
      {%- endif -%}
    {%- endfor -%}

    {%- unless product.available -%}
      <span class="label label--subdued">{{ 'collection.product.sold_out' | t }}</span>
    {%- endunless -%}


    {%- if settings.show_discount and product.available and product.price < product.compare_at_price -%}
          {% comment %}
            {%- if settings.discount_mode == 'percentage' -%}
              {%- assign savings = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round | append: '%' -%}
              {%- assign savingslevel = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round -%}
            {%- else -%}
              {%- capture savings -%}{{ product.compare_at_price | minus: product.price | money }}{%- endcapture -%}
            {%- endif -%}
          {% endcomment %}
      
      {% assign highestSavingslevel = 0 %}
      {% for variant in product.variants %}
        {% if variant.metafields.data.shown != false %}
          {%- if settings.discount_mode == 'percentage' -%}
            {% assign savingslevel = variant.compare_at_price | minus: variant.price | times: 100.0 | divided_by: variant.compare_at_price | round %}
            {% if savingslevel > highestSavingslevel %}
              {% assign highestSavingslevel = savingslevel %}
            {% endif %}
          {% endif %}
        {% endif %}
      {% endfor %}

      {%  if highestSavingslevel > 5 %}<span class="label label--highlight">{{ highestSavingslevel }}% OFF{% comment %}-{{ savings }}{{ 'collection.product.discount_html' | t: savings: savings }}{% endcomment %}</span>{%  endif %}

    {%- endif -%}
  {%- endcapture -%}
  {%- capture rebatelabel -%}
  <div class="overlay-wrapper">
      {%- if request.page_type != 'product' and hide_image_tags != true -%}
         {%  if product.tags contains "Refurbished" %}
           <span class="refurbished_label label _label _label-margin-fix" style="background-image: url('{{ 'certified-refurbished-48x48.png' | asset_url }}');"></span>
         {% endif %}
         {% if product.vendor contains "MaxLite" %}
            <span class="vendor_label label _label" style="background-image: url('{{ 'maxlite-icon-48x48.png' | asset_url }}');"></span>
         {% endif %}
         {% if product.vendor contains "RAB Lighting" %}
            <span class="vendor_label label _label" style="background-image: url('{{ 'rab-icon-48x48.png' | asset_url }}');"></span>
         {% endif %}
         {% if product.vendor contains "Archipelago" %}
            <span class="vendor_label label _label" style="background-image: url('{{ 'archipelago-icon-48x48.png' | asset_url }}');"></span>
         {% endif %}
         {% if product.vendor contains "Nora Lighting" %}
            <span class="vendor_label label _label" style="background-image: url('{{ 'nora-icon-48x48.png' | asset_url }}');"></span>
         {% endif %}
         {% if product.vendor contains "LED Living" %}
            <span class="vendor_label label _label" style="background-image: url('{{ 'ledliving-icon-48x48.png' | asset_url }}');"></span>
         {% endif %}
         {% if product.vendor contains "Mann Manufacturing" %}
            <span class="vendor_label label _label" style="background-image: url('{{ 'mannmanufacturing-icon2-48x48.png' | asset_url }}');"></span>
         {% endif %}
         {% comment %}{%  if product.tags contains "Staff Pick" %}
           <span class="staffpick_label label _label _label-margin-fix" style="background-image: url('{{ 'staff-pick-48x48.png' | asset_url }}');"></span>
         {% endif %} {% endcomment %}
         {% comment %}{%  if product.tags contains "On Sale Now" %}
           <span class="sale_label label _label" style="background-image: url('{{ 'sale-48x48.png' | asset_url }}');"></span>
         {% endif %}{% endcomment %}
         {% comment %}{%- if product.tags contains 'DLC 5.1' -%}
           <span class="rebate_label label _label" style="background-image: url('{{ 'rebate-eligible-48x48.png' | asset_url }}');"></span>
         {%- endif -%} {% endcomment %}
         {%  if product.tags contains "Buy American Compliant" %}
           <span class="american_label label _label _label-margin-fix" style="background-image: url('{{ 'buy-american-48x48.png' | asset_url }}');"></span>
         {% endif %}
         {%- if product.tags contains 'Clearance' -%}
           <span class="rebate_label label _label" style="background-image: url('{{ 'closeout-48x48.png' | asset_url }}');"></span>
         {%- endif -%}
     {%- endif -%}
  </div>
  {%- endcapture -%}
  <div class="product-item__image-wrapper {% if settings.show_secondary_image and product.media.size > 1 and hide_secondary_image != true %}product-item__image-wrapper--multiple{% endif %}">
    {% comment %}{%- if product_labels != blank and reduced_content != true -%}
      <div class="product-item__label-list label-list">
        {{- product_labels -}}
      </div>
    {%- endif -%}{% endcomment %}
    {%  comment %}  
  <a href="{{ product.url | within: collection }}" class="product-item__aspect-ratio aspect-ratio {% if settings.product_image_size != 'natural' %}aspect-ratio--{{ settings.product_image_size }}{% endif %}" style="padding-bottom: {{ 100.0 | divided_by: product.featured_media.preview_image.aspect_ratio }}%; --aspect-ratio: {{ product.featured_media.preview_image.aspect_ratio }}">
  {% endcomment %}
  <a href="{{ product.url | within: collection }}" class="product-item__aspect-ratio aspect-ratio {% if settings.product_image_size != 'natural' %}aspect-ratio--{{ settings.product_image_size }}{% endif %}" style="padding-bottom: {%- if product.featured_media.preview_image.aspect_ratio != null -%}{{ 100.0 | divided_by: product.featured_media.preview_image.aspect_ratio }}%; --aspect-ratio: {{ product.featured_media.preview_image.aspect_ratio }}{%- else -%}{{ '100%; --aspect-ratio: 1.0;' }}{%- endif -%}">
    {%- if rebatelabel != blank -%}
      {{ rebatelabel }}
    {%- endif -%}
      <img class="product-item__primary-image" loading="lazy" data-media-id="{{ product.featured_media.id | escape }}" sizes="{{ sizes_attribute }}" {% if is_small_img != true %}{% render 'image-attributes', image: product.featured_media, sizes: '200,300,400' | strip_newlines %}> {% else  %}{% render 'image-attributes', image: product.featured_media, sizes: '200' | strip_newlines %}>{% endif %}
    
      {%- if settings.product_color_display == 'swatch' -%}
        {%- assign featured_media = product.variants | map: 'featured_media' -%}
    
        {%- for media in featured_media -%}
          {%- unless media == product.featured_media -%}
            <img class="product-item__primary-image" hidden data-media-id="{{ media.id | escape }}" loading="lazy" sizes="{{ sizes_attribute }}" {% if is_small_img != true %}{% render 'image-attributes', image: media, sizes: '200,300,400' | strip_newlines %}> {% else  %}{% render 'image-attributes', image: media, sizes: '200' | strip_newlines %}>{% endif %}
          {%- endunless -%}
        {%- endfor -%}
      {%- endif -%}
    
      {%- if settings.show_secondary_image and product.media.size > 1 and hide_secondary_image != true -%}
        <img class="product-item__secondary-image" loading="lazy" sizes="{{ sizes_attribute }}" {% if is_small_img != true %}{% render 'image-attributes', image: product.media[1], sizes: '200,300,400' | strip_newlines %}> {% else  %}{% render 'image-attributes', image: product.media[1], sizes: '200' | strip_newlines %}>{% endif %}
      {%- endif -%}
    </a>
    {%  if minimum_content == true %}
    {%  else %}
    {%- comment -%} Zoe edit PRODUCT LABEL/BADGE LOCATIONS ON IMAGE: Groups 1 & 3 - 1 is bottom right & 3 is top right{%- endcomment -%}

    {% render 'primeb', product: product, hideAssets:'1', primebGroup: '1', primebOuterClass:'prime-d-inline-block', primebOuterStyle:'position: absolute; left: 0; bottom: 0; padding: 8px; z-index: 0;', primebInnerStyle:'', primebInnerClass: 'prime-d-inline-block prime-mr-1' | strip_newlines %}
    {% render 'primeb', product: product, hideAssets:'1', primebGroup: '3', primebOuterClass:'prime-d-inline-block', primebOuterStyle:'position: absolute; right: 0; top: 0; z-index: 0;', primebInnerStyle:'', primebInnerClass: 'prime-d-inline-block prime-mr-1 prime-mb-1' | strip_newlines %}

    {% endif %}
    {%- if request.page_type != 'password' and settings.product_add_to_cart and product.available and reduced_content != true and show_cta != true -%}
{% comment %}Removing direct add to cart button/link: only using quick view
      - if product.variants.size == 1 -
{% endcomment %}
      {%- if product.variants.size == -1 -%}
        {%- capture form_id -%}product_form_{{ section.id }}_{{ block.id }}_{{ product.id }}_{% increment product_form_index %}{%- endcapture -%}
        {%- form 'product', product, is: 'product-form', id: form_id, class: 'product-item__quick-form' -%}
          <input type="hidden" name="quantity" value="1">
          <input type="hidden" name="id" value="{{ product.first_available_variant.id }}">
          <button is="loader-button" type="submit" class="button button--outline button--text button--full {% if section.settings.desktop_products_per_row >= 5 %}button--small{% endif %} hidden-touch">{{ 'collection.product.add_to_cart_short' | t }}</button>
          <button type="submit" class="product-item__quick-buy-button hidden-no-touch">
            <span class="visually-hidden">{{ 'collection.product.add_to_cart_short' | t }}</span>
            {%- render 'icon' with quick_buy_icon_name | strip_newlines -%}
          </button>
        {%- endform -%}
      {%- else -%}
        {%- comment -%}
        IMPLEMENTATION NOTE: Depending on the device we show a different icon or open a different mode (either popover or drawer)
        {%- endcomment -%}

        <div class="product-item__quick-form">
          <button is="toggle-button" loader aria-controls="product-{{ section.id }}-{{ block.id }}-{{ product.id }}-drawer" aria-expanded="false" class="button button--outline button--text button--full {% if section.settings.desktop_products_per_row >= 5 %}button--small{% endif %} hidden-touch hidden-phone">{{ 'collection.product.quick_view' | t }}</button>
          <button is="toggle-button" aria-controls="product-{{ section.id }}-{{ block.id }}-{{ product.id }}-drawer" aria-expanded="false" class="product-item__quick-buy-button hidden-no-touch hidden-phone">
            <span class="visually-hidden">{{ 'collection.product.quick_view' | t }}</span>
            {%- render 'icon' with quick_buy_icon_name | strip_newlines -%}
          </button>

          <button is="toggle-button" aria-controls="product-{{ section.id }}-{{ block.id }}-{{ product.id }}-popover" aria-expanded="false" class="product-item__quick-buy-button hidden-tablet-and-up">
            <span class="visually-hidden">{{ 'collection.product.quick_view' | t }}</span>
            {%- render 'icon' with quick_buy_icon_name | strip_newlines -%}
          </button>
        </div>

        <quick-buy-popover id="product-{{ section.id }}-{{ block.id }}-{{ product.id }}-popover" href="{{ product.url | within: collection }}{% if product_url_contains_query %}&{% else %}?{% endif %}view=quick-buy-popover" class="popover popover--quick-buy hidden-tablet-and-up"></quick-buy-popover>
        <quick-buy-drawer id="product-{{ section.id }}-{{ block.id }}-{{ product.id }}-drawer" href="{{ product.url | within: collection }}{% if product_url_contains_query %}&{% else %}?{% endif %}view=quick-buy-drawer" class="drawer drawer--large drawer--quick-buy hidden-phone"></quick-buy-drawer>
      {%- endif -%}
    {%- endif -%}
  </div>
  <div class="product-item__info {% if show_cta %}product-item__info--with-button{% endif %} {% if reduced_font_size %}text--small{% endif %}">
    <div class="product-item-meta">
      {%- if settings.show_vendor -%}
        {%- assign vendor_handle = product.vendor | handle -%}
        {%- assign collection_for_vendor = collections[vendor_handle] -%}

        {%- unless collection_for_vendor.empty? -%}
          <a class="product-item-meta__vendor heading heading--xsmall" href="{{ collection_for_vendor.url }}">{{ product.vendor }}</a>
        {%- else -%}
          <a class="product-item-meta__vendor heading heading--xsmall" href="{{ product.vendor | url_for_vendor }}">{{ product.vendor }}</a>
        {%- endunless -%}
      {%- endif -%}
      <a href="{{ product.url | within: collection }}" class="product-item-meta__title">{{ product.title }}</a>
      {% if request.page_type == 'collection' or request.page_type == 'page' %}
        <a href="{{ product.url | within: collection }}" class="product-item-meta__landingbullets">
        {% if product.metafields.data.landing_page_bullets.value %}
          <p class="product-item-meta__landing-bullets">{{ product.metafields.data.landing_page_bullets.value }}</p>
        {%  endif %}
        {% unless product.metafields.data.landing_page_bullets.value %}
            {% if product.metafields.data.landing_page_desc.value %}
            <p class="product-item-meta__landing-desc">{{ product.metafields.data.landing_page_desc.value }}</p>
            {%  endif %}
        {%  endunless %}
        </a>
      {%  endif %}
      
      {%comment%}
  		
      	{%endcomment%}
    {%  if minimum_content == true %}
    {%  else %}
        <div class="wc_product_review_badge" data-handle="{{ product.handle }}" data-product_id="{{ product.id }}"></div>
        <style>.wc_product_review_badge { top: -5px; } .wc_product_review_badge .wc_review_badge_inner { padding: 0; } .wc_review_badge_wrap .wc_icon_color svg, #wc_review_section .wc_review_badge_wrap .wc_icon_color svg { width: 80px !important; }</style>
    {%  endif %}
      {% comment %}
      <div class="product-item-meta__price-list-container">
        <div class="price-list price-list--centered">
          {%- if product.price_varies and product.compare_at_price -%}
            {%- assign cheapest_variant = product.variants | sort: 'price' | first -%}

            {%- capture price_min -%}
              {%- if settings.currency_code_enabled -%}
                {{- cheapest_variant.price | money_with_currency -}}
              {%- else -%}
                {{- cheapest_variant.price | money -}}
              {%- endif -%}
            {%- endcapture -%}

            {%- if cheapest_variant.price < cheapest_variant.compare_at_price -%}
              <span class="price price--highlight">
                <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
                {{ 'collection.product.from_price_html' | t: price_min: price_min }}
              </span>

              <span class="price price--compare">
                <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>

                {%- if settings.currency_code_enabled -%}
                  {{- cheapest_variant.compare_at_price | money_with_currency -}}
                {%- else -%}
                  {{- cheapest_variant.compare_at_price | money -}}
                {%- endif -%}
              </span>
            {%- else -%}
              <span class="price">
                <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
                {{- 'collection.product.from_price_html' | t: price_min: price_min -}}
              </span>
            {%- endif -%}
          {%- elsif product.price < product.compare_at_price -%}
            <span class="price price--highlight">
              <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>

              {%- if settings.currency_code_enabled -%}
                {{- product.price | money_with_currency -}}
              {%- else -%}
                {{- product.price | money -}}
              {%- endif -%}
            </span>
          
            <span class="price price--compare">
              <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>
              {%- if settings.currency_code_enabled -%}
                {{- product.compare_at_price | money_with_currency -}}
              {%- else -%}
                {{- product.compare_at_price | money -}}
              {%- endif -%}
            </span>
          {%- elsif product.price_varies -%}
            {%- capture price_min -%}
              {%- if settings.currency_code_enabled -%}
                {{ product.price_min | money_with_currency }}
              {%- else -%}
                {{ product.price_min | money }}
              {%- endif -%}
            {%- endcapture -%}

            {%- capture price_max -%}
              {%- if settings.currency_code_enabled -%}
                {{- product.price_max | money_with_currency -}}
              {%- else -%}
                {{- product.price_max | money -}}
              {%- endif -%}
            {%- endcapture -%}
 
            <span class="price">
              <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
              {{- 'collection.product.from_price_html' | t: price_min: price_min, price_max: price_max -}}
            </span>
          {%- else -%}
            <span class="price">
              <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>

              {%- if settings.currency_code_enabled -%}
                {{- product.price | money_with_currency -}}
              {%- else -%}
                {{- product.price | money -}}
              {%- endif -%}
            </span>
          {%- endif -%}
          
          		
          		{%if product.compare_at_price != null%}          
				<span class="unit-price-show" style="color: rgb(252, 83, 40)">
          		{%else%}          
				<span class="unit-price-show">
          		{%endif%}

                {% assign current_variant = product.selected_or_first_available_variant %}
                {% assign bundled_variants = current_variant.metafields.simple_bundles.bundled_variants.value %}
                {% for bundled_variant in bundled_variants %}        					
                <span class="unit-price-show">/&nbsp; {{ product.selected_or_first_available_variant.price | divided_by: bundled_variant.quantity_in_bundle | money }}&nbsp;ea</span>   
                {% endfor %}
                </span>   
          		<span> </span>
          		{%if product.compare_at_price != null%}
          		<span class="unit-price-show">
                {% assign current_variant = product.selected_or_first_available_variant %}
                {% assign bundled_variants = current_variant.metafields.simple_bundles.bundled_variants.value %}
                {% for bundled_variant in bundled_variants %}        					
                <span class="unit-price-show" style="text-decoration: line-through; color: grey">/&nbsp;{{ product.compare_at_price | divided_by: bundled_variant.quantity_in_bundle | money}}&nbsp;ea</span>   
                {% endfor %}
                </span> 
          		{%endif%}
          
          		
          
          {%- if product.selected_or_first_available_variant.unit_price_measurement -%}
            <div class="price price--block text--xsmall text--subdued">
              <div class="unit-price-measurement">
                <span class="unit-price-measurement__price">{{ product.selected_or_first_available_variant.unit_price | money }}</span>
                <span class="unit-price-measurement__separator">/</span>

                {%- if product.selected_or_first_available_variant.unit_price_measurement.reference_value != 1 -%}
                  <span class="unit-price-measurement__reference-value">{{ product.selected_or_first_available_variant.unit_price_measurement.reference_value }}</span>
                {%- endif -%}

                <span class="unit-price-measurement__reference-unit">{{ product.selected_or_first_available_variant.unit_price_measurement.reference_unit }}</span>  
              </div>
            </div>
          {%- endif -%}
        </div>
      </div>
{% endcomment %}

        
{% comment %}/// PRICING STARTS ///{% endcomment %}    
    <div class="product-item-meta__price-list-container">
        <div class="price-list price-list--centered">
            {%- assign cheapest_variant = product.variants | sort: 'price' | last -%}
            {%- assign expensive_variant = product.variants | sort: 'price' | first -%}
            {%- if product.price_varies and product.compare_at_price -%}
            
                {% comment %} Use only the variants that are supposed to be shown {% endcomment %}
                {% for variant in product.variants %}
                  {% if variant.metafields.data.shown != false %}
                    {% if variant.price < cheapest_variant.price %}
                      {% assign cheapest_variant = variant %}
                    {% endif %}
  
                    {% if variant.price > expensive_variant.price %}
                      {% assign expensive_variant = variant %}
                    {% endif %}
                  {% endif %}
                {% endfor %}

                {%- capture price_min -%}
                  {%- if settings.currency_code_enabled -%}
                      {{- cheapest_variant.price | money_with_currency -}}
                  {%- else -%}
                      {{- cheapest_variant.price | money -}}
                  {%- endif -%}
                {%- endcapture -%}
                {%- capture price_max -%}
                  {%- if settings.currency_code_enabled -%}
                      {{- expensive_variant.price | money_with_currency -}}
                  {%- else -%}
                      {{- expensive_variant.price | money -}}
                  {%- endif -%}
                {%- endcapture -%}

                {%- if cheapest_variant.price < cheapest_variant.compare_at_price -%}
                  {% capture newpriceblock %}
                    <span class="price price--highlight">
                        <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
                        <!--{{- 'collection.product.from_price_html' | t: price_min: price_min, price_max: price_max -}}-->
                        {% if cheapest_variant.price == expensive_variant.price %}
                          {{ price_min }}
                        {% else %}
                          {{ price_min }} &hyphen;&nbsp;{{ price_max }}
                        {% endif %}
                        
                    </span>
                  {% endcapture %}
                  {% capture oldpriceblock %}
                    <span class="price price--compare">
                        <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>
                        {% if cheapest_variant.price == expensive_variant.price %}
                          {%- if settings.currency_code_enabled -%}
                              {{ cheapest_variant.compare_at_price | money_with_currency }}
                          {%- else -%}
                              {{ cheapest_variant.compare_at_price | money }}
                          {%- endif -%}
                        {% else %}
                          {%- if settings.currency_code_enabled -%}
                              {{ cheapest_variant.compare_at_price | money_with_currency }} &hyphen;&nbsp;{% if expensive_variant.compare_at_price %}{{ expensive_variant.compare_at_price | money_with_currency }}{% else %}{{  expensive_variant.price | money_with_currency }}{% endif %}
                          {%- else -%}
                              {{ cheapest_variant.compare_at_price | money }} &hyphen;&nbsp;{% if expensive_variant.compare_at_price > 0 %}{{ expensive_variant.compare_at_price | money }}{% else %}{{  expensive_variant.price | money }}{% endif %}
                          {%- endif -%}
                        {% endif %}
                    </span>
                  {% endcapture %}
                {%- else -%}
                  {% capture hiddenpriceblock %}
                    <span class="price">
                        <span class="visually-hidden">{{ 'product.general.sale_price' | t }} </span>
                        {% if cheapest_variant.price == expensive_variant.price %}
                          {{ price_min }}
                        {% else %}
                          {{ price_min }} &hyphen;&nbsp;{% if expensive_variant.compare_at_price %}{{ expensive_variant.compare_at_price | money }}{% else %}{{  expensive_variant.price | money }}{% endif %}
                        {% endif %}
                        </span>
                  {% endcapture %}
                {%- endif -%}
            {%- elsif product.price < product.compare_at_price -%}
                {%- capture newpriceblock -%}
                    <span class="price price--highlight">
                        <span class="visually-hidden">{{ 'product.general.sale_price' | t }} </span>
                        {%- if settings.currency_code_enabled -%}
                           { product.price | money_with_currency }}
                        {%- else -%}
                            {{ product.price | money }}
                        {%- endif -%}
                    </span>
                {%- endcapture -%}
                {% capture oldpriceblock %}
                    <span class="price price--compare">
                        <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>
                        {%- if settings.currency_code_enabled -%}
                          {{ product.compare_at_price | money_with_currency }}
                        {%- else -%}
                         {{ product.compare_at_price | money }}
                        {%- endif -%}
                    </span>
                {% endcapture %}
            {%- elsif product.price_varies -%}
                {% comment %} Use only the variants that are supposed to be shown {% endcomment %}
                {% for variant in product.variants %}
                  {% if variant.metafields.data.shown != false %}
                    {% if variant.price < cheapest_variant.price %}
                      {% assign cheapest_variant = variant %}
                    {% endif %}
  
                    {% if variant.price > expensive_variant.price %}
                      {% assign expensive_variant = variant %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
          
                {% capture price_min %}
                  {%- if settings.currency_code_enabled -%}
                     {{ cheapest_variant.price | money_with_currency }} 
                  {%- else -%}
                     {{ cheapest_variant.price | money }} 
                  {%- endif -%}
                {% endcapture %}
                
                {% capture price_max %}
                  {%- if settings.currency_code_enabled -%} 
                      <span> &hyphen;&nbsp;{{ expensive_variant.price | money_with_currency }}</span>
                  {%- else -%}
                      <span> &hyphen;&nbsp;{{ expensive_variant.price | money }}</span>
                  {%- endif -%}
                {% endcapture %}
                {% capture hiddenpriceblock %}
                  <span class="price">
                      <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
                      {% if cheapest_variant.price == expensive_variant.price %}
                        {{ price_min }}
                      {% else %}
                        {{ price_min }} {{ price_max }}
                      {% endif %}
                  </span>
                {% endcapture %}
            {%- else -%}
                {%-capture hiddenpriceblock -%}
                  <span class="price">
                      <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
                      {%- if settings.currency_code_enabled -%}
                          {{ product.price | money_with_currency }}
                      {%- else -%}
                          {{ product.price | money }}
                      {%- endif -%}
                  </span>
                {%- endcapture -%}
            {%- endif -%}
            
            {%- capture newunitpriceblock -%}      
              {%if product.compare_at_price != null%}
            		{% assign newpriceshow = true %}
  				<span class="unit-price-show" style="color: rgb(252, 83, 40)">
              {%else%}
                  {% assign newpriceshow = false %}
  				<span class="unit-price-show">
              {%endif%}
              {% assign current_variant = product.selected_or_first_available_variant %}
              {% assign bundled_variants = current_variant.metafields.simple_bundles.bundled_variants.value %}
              {% assign number_bundle_items = 0 %}
              {% for bundled_variant in bundled_variants %}
                 {% assign number_bundle_items = number_bundle_items | plus: 1 %}
              {% endfor %}
              {% if number_bundle_items == 1 %}  
                    {% for bundled_variant in bundled_variants %}        					
                      <span class="unit-price-show">/&nbsp; {{- product.selected_or_first_available_variant.price | divided_by: bundled_variant.quantity_in_bundle | money -}}&nbsp;ea</span>   
                  {% endfor %}
              {% endif %}
              </span>   
            {%- endcapture -%}
            {%- capture oldunitpriceblock -%}
              <span> </span>
              {%if product.compare_at_price != null%}
            		<span class="unit-price-show">
                      {% assign current_variant = product.selected_or_first_available_variant %}
                      {% assign bundled_variants = current_variant.metafields.simple_bundles.bundled_variants.value %}
                      {% assign number_bundle_items = 0 %}
                      {% for bundled_variant in bundled_variants %}
                         {% assign number_bundle_items = number_bundle_items | plus: 1 %}
                      {% endfor %}
                      {% if number_bundle_items == 1 %}  
                    		{% for bundled_variant in bundled_variants %}        					
                          	<span class="unit-price-show" style="text-decoration: line-through; color: grey">/&nbsp; {{- product.compare_at_price | divided_by: bundled_variant.quantity_in_bundle | money -}}&nbsp;ea</span>   
                      	{% endfor %}
                  	{% endif %}
                  </span> 
              {%endif%}
            {%- endcapture -%}
            {%- if product.selected_or_first_available_variant.unit_price_measurement -%}
              {%- capture smallpriceblock -%}
                <div class="price price--block text--xsmall text--subdued">
                    <div class="unit-price-measurement">
                        <span class="unit-price-measurement__price">{{ product.selected_or_first_available_variant.unit_price | money }}</span>
                        <span class="unit-price-measurement__separator">/&nbsp;</span>
                        {%- if product.selected_or_first_available_variant.unit_price_measurement.reference_value != 1 -%}
                            <span class="unit-price-measurement__reference-value">{{ product.selected_or_first_available_variant.unit_price_measurement.reference_value }}</span>
                        {%- endif -%}
                        <span class="unit-price-measurement__reference-unit">{{ product.selected_or_first_available_variant.unit_price_measurement.reference_unit }}</span>  
                    </div>
                </div>
              {%- endcapture -%}
            {%- endif -%}


          {% comment %} Adding Shipping notice if there is inventory {% endcomment %}
            {%- if request.page_type == 'collection' or request.page_type == 'page' -%}
              {% assign target_tags = "MaxLite,Mester,XSY LIGHTING Shenzhen" | split: "," %}
              {% assign found = false %}
              {% assign has_inventory = false %}
              {% assign all_have_inventory = true %}
            
              {% for variant in product.variants %}
                {% if variant.inventory_quantity > 0 %}
                  {% assign has_inventory = true %}
                {% else %}
                  {% assign all_have_inventory = false %}
                {% endif %}
              {% endfor %}
              
              {% if has_inventory %}
                {% for tag in product.tags %}
                  {% if target_tags contains tag %}
                    {% assign found = true %}
                    {% break %}
                  {% endif %}
                {% endfor %}
            
                {%- capture shippingnote -%}
                {% if all_have_inventory %}
                  {% if found %}
                    <div class="shippingtag"><span>Ships 1-2 days</span></div>
                  {% else %}
                    <div class="shippingtag"><span>Ships same day</span></div>
                  {% endif %}
                {% else %}
                  {% if found %}
                    <div class="shippingtag"><span>Some items ship in 1-2 days</span></div>
                  {% else %}
                    <div class="shippingtag"><span>Some items ship same day</span></div>
                  {% endif %}
                {% endif %}
                {%- endcapture -%}
              {% endif %}
            {%- endif -%}
            
            <div>
              <div>
        	    {{ oldpriceblock }}
            	{{ oldunitpriceblock }}
              </div>
              <div>
	            {{ hiddenpriceblock }}
                {{ smallpriceblock }}
                {{ newpriceblock }}
                {{ newunitpriceblock }}
                {{- product_labels -}}
              </div>
              {% if shippingnote != blank %}
                <div>
                  {{- shippingnote -}}
                </div>
              {% endif %}
            </div>
        </div>
    </div>

      {%- if settings.show_product_rating and reduced_content != true -%}
        <a class="product-item-meta__reviews-badge text--small" href="{{ product.url | within: collection }}">
          {%- render 'product-rating', product: product | strip_newlines -%}
        </a>
      {%- endif -%}

      {%- if settings.product_color_display != 'hide' and reduced_content != true -%}
        {%- for color_label in color_label_list -%}
          {%- if product.options_by_name[color_label] != blank -%}
            {%- assign product_option = product.options_by_name[color_label] -%}

            {%- case settings.product_color_display -%}
              {%- when 'count' -%}
                <p class="product-item-meta__color-count text--small text--subdued">{{- 'collection.product.available_colors_count' | t: count: product_option.values.size -}}</p>

              {%- when 'swatch' -%}
                <div class="product-item-meta__swatch-list color-swatch-list color-swatch-list--mini">
                  {%- assign variant_option = 'option' | append: product_option.position -%}
                  {%- assign color_swatch_config = settings.color_swatch_config | newline_to_br | split: '<br />' -%}

                  {%- capture color_name -%}{{ section.id }}-{{ block.id }}-{{ product.id }}{%- endcapture -%}

                  {%- for value in product_option.values -%}
                    {%- capture color_id -%}{{ color_name }}-{{ forloop.index }}{%- endcapture -%}
                    {%- assign color_value_downcase = value | downcase -%}
                    {%- assign variant_for_value = product.variants | where: variant_option, value | first -%}

                    <div class="color-swatch {% if color_white_label == color_value_downcase %}color-swatch--white{% endif %}">
                      <input class="color-swatch__radio visually-hidden" type="radio" name="{{ color_name }}" id="{{ color_id }}" value="{{ value | escape }}" {% if product_option.selected_value == value %}checked="checked"{% endif %} data-variant-id="{{ variant_for_value.id }}" {% if variant_for_value.featured_media %}data-variant-featured-media="{{ variant_for_value.featured_media.id }}"{% endif %}>
                      <label class="color-swatch__item" for="{{ color_id }}" style="{% render 'color-swatch-style', color_swatch_config: color_swatch_config, value: value | strip_newlines %}">
                        <span class="visually-hidden">{{ value }}</span>
                      </label>
                    </div>
                  {%- endfor -%}
                </div>
            {%- endcase -%}

            {%- break -%}
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}
    </div>
{% comment %}
    {%- if product.available and reduced_content or show_cta -%}
      <div class="product-item__cta-wrapper">
      {%- if product.variants.size == -1 -%}
          {%- capture form_id -%}product_form_{{ section.id }}_{{ block.id }}_{{ product.id }}_{% increment product_form_index %}{%- endcapture -%}
          {%- form 'product', product, is: 'product-form', id: form_id -%}
            <input type="hidden" name="quantity" value="1">
            <input type="hidden" name="id" value="{{ product.first_available_variant.id }}">
            <button type="submit" {% if show_cta %}is="loader-button"{% endif %} class="{% if reduced_content %}product-item__link link text--subdued{% else %}product-item__cta button button--primary{% endif %}">{{ 'collection.product.add_to_cart_short' | t }}</button>
          {%- endform -%}
        {%- else -%}
          {%  if no_quickview == true %}
          {%  else %}
          <button type="button" {% if show_cta %}loader{% endif %} is="toggle-button" aria-controls="product-{{ section.id }}-{{ block.id }}-{{ product.id }}-drawer" aria-expanded="false" class="{% if reduced_content %}product-item__link link text--subdued{% else %}product-item__cta button button--primary{% endif %} hidden-phone">{{ 'collection.product.quick_view' | t }}</button>
          <button type="button" {% if show_cta %}loader{% endif %} is="toggle-button" aria-controls="product-{{ section.id }}-{{ block.id }}-{{ product.id }}-popover" aria-expanded="false" class="{% if reduced_content %}product-item__link link text--subdued{% else %}product-item__cta button button--primary{% endif %} hidden-tablet-and-up">{{ 'collection.product.quick_view' | t }}</button>

          <quick-buy-popover id="product-{{ section.id }}-{{ block.id }}-{{ product.id }}-popover" href="{{ product.url | within: collection }}{% if product_url_contains_query %}&{% else %}?{% endif %}view=quick-buy-popover" class="popover popover--quick-buy hidden-tablet-and-up"></quick-buy-popover>
          <quick-buy-drawer id="product-{{ section.id }}-{{ block.id }}-{{ product.id }}-drawer" href="{{ product.url | within: collection }}{% if product_url_contains_query %}&{% else %}?{% endif %}view=quick-buy-drawer" class="drawer drawer--large drawer--quick-buy hidden-phone"></quick-buy-drawer>
          <style>
            #shopify-section-{{ section.id }} .shopify-payment-button__more-options {
              display: none;
            }
          </style>
          {%  endif %}
        {%- endif -%}
      </div>
    {%- elsif reduced_content -%}
      <div class="product-item__cta-wrapper">
        <span class="product-item__link text--subdued">{{ 'collection.product.sold_out' | t }}</span>
      </div>
    {%- endif -%}
{% endcomment %}
    
    {%- comment -%}Group 2 is for the badges below the title on the collections page {%- endcomment -%}
    {% render 'primeb', product: product, hideAssets:'1', primebGroup:'2', primebOuterClass:'prime-d-inline-block prime-mr-1', primebOuterStyle:'display: inline-block !important', primebInnerStyle:'', primebInnerClass: 'prime-d-inline-block prime-mb-1' | strip_newlines %}
    
  </div>
  	
  </product-item>
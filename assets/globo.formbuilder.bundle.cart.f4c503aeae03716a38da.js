"use strict";(self.webpackChunkgloboFormbuilder=self.webpackChunkgloboFormbuilder||[]).push([[511],{2553:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s});var o=r(6225);const s=class{constructor(e){this.form=e}setAttributeType(){this.form.setAttribute("type","cart")}updateCartNote(){const e=this;let t={};t["Cart form"]=(0,o.FT)(e.form.getAttribute("data-id").toString()),e.form.querySelectorAll("input, textarea, select").forEach((function(r){if("hidden"==r.type){if("_keyLabel"!=r.name){const o=e.getAtrributeName(r.name);t[e.capitalizeFirstLetter(o[0])+" "+o[1]]=r.value?r.value:""}}else e.setAtrributeValue(t,r,!0)})),this.updateAttributes(t)}setAtrributeValue(e,t,r){const o=this,s=o.closestParent(t.parentNode,"globo-form-control").querySelector(".label-content").innerText;if(null!==t.getAttribute("presence")&&(t.classList.add("required"),t.setAttribute("required","")),"checkbox"==t.type)"acceptTerms[]"==t.name?e[s]=t.checked?t.value:"":(e[s]=e[s]||"",t.checked?(e[s]=this.removeCheckboxOption(e[s],""),e[s]+=e[s]?", "+t.value:t.value):(e[s]=this.removeCheckboxOption(e[s],t.value),e[s]=e[s]?e[s]:""));else if("file"==t.type){const r=o.closestParent(t,"globo-form-control"),l=t.files;let i=[];if(Object.values(l).map((e=>{i.push(e.name)})),e[s]=i.length?i.join(", "):"",l.length){let i=[];Globo.FormBuilder.forms[o.form.getAttribute("data-id")].elements.forEach((e=>{"group"==e.type?i=i.concat(e.elements):i.push(e)}));const n=i.find((e=>e.id==o.getAtrributeName(t.name)[0]));r.querySelector(".messages").innerHTML='<p class="help-block loading">'+n.uploadPending+"</p>";let c=new FormData;for(var a=0;a<l.length;a++)c.append(o.getAtrributeName(t.name)[0]+"[]",l[a]);c.append("form_id",o.form.getAttribute("data-id")),c.append("name",o.getAtrributeName(t.name)[0]),void 0!==Globo.FormBuilder.url&&fetch(Globo.FormBuilder.url+"/api/front/uploadFiles",{method:"POST",body:c}).then((e=>e.json())).then((a=>{if(a.success){r.classList.remove("has-error"),r.querySelector(".messages").innerHTML='<p class="help-block success">'+n.uploadSuccess+"</p>";for(var i=1;i<=l.length;i++){let r=s+(t.multiple?" download no."+i:" download");e[r]="",!1!==a.fileNames?e[r]=a.fileNames[Number(i)-1]:!1!==a.isUploadable?e[r]=a.isUploadable:!1!==a.isStorageable&&(e[r]=a.isStorageable)}if(t.multiple){const t=Object.keys(e).filter((e=>e.indexOf("download no.")>-1));t.length>l.length&&t.map(((t,r)=>{r+1>l.length&&(e[t]="")}))}this.updateAttributes(e)}else{const e=Globo.FormBuilder.forms[o.form.getAttribute("data-id")].errorMessage;r.classList.add("has-error"),r.querySelector(".messages").innerHTML="<p class='help-block error'>"+("File not allowed"==a.error||"File size limit"==a.error?e.fileNotAllowed:a.error)+"</p>"}})).catch((e=>{console.error(e)}))}else{Object.keys(e).filter((e=>e.indexOf("download")>-1)).map((t=>e[t]="")),this.updateAttributes(e),r.classList.remove("has-error"),r.querySelector(".messages").innerHTML=""}}else"radio"==t.type?e[s]=t.checked?t.value:"":e[s]=t.value?t.value:"";r&&this.onActionSetAttribute(e,"change",t)}onActionSetAttribute(e,t,r){const o=this;r.addEventListener(t,(function(t){o.setAtrributeValue(e,t.target,!1),o.updateAttributes(e)}))}getAtrributeName(e){return e.split(/[\[\]]/)}removeCheckboxOption(e,t){return e.indexOf(", "+t)>-1?e.replace(", "+t,""):e.indexOf(t+", ")>-1?e.replace(t+", ",""):e.indexOf(t)>-1?e.replace(t,""):e}capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}closestParent(e,t){return e&&e!=document?e.classList.contains(t)?e:this.closestParent(e.parentNode,t):null}updateAttributes(e){fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attributes:e})}).then((e=>e.json())).then((e=>{console.log("Update cart attributes success",e)})).catch((e=>{console.error("Update cart attributes error",e)}))}}}}]);